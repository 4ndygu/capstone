(function(t){function e(e){for(var n,s,o=e[0],c=e[1],l=e[2],u=0,h=[];u<o.length;u++)s=o[u],r[s]&&h.push(r[s][0]),r[s]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);d&&d(e);while(h.length)h.shift()();return i.push.apply(i,l||[]),a()}function a(){for(var t,e=0;e<i.length;e++){for(var a=i[e],n=!0,o=1;o<a.length;o++){var c=a[o];0!==r[c]&&(n=!1)}n&&(i.splice(e--,1),t=s(s.s=a[0]))}return t}var n={},r={"case-editor":0},i=[];function s(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=n,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(a,n,function(e){return t[e]}.bind(null,n));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/static/dist/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var d=c;i.push([10,"chunk-common"]),a()})({10:function(t,e,a){t.exports=a("1a45")},"12c0":function(t,e,a){"use strict";var n=a("9692"),r=a.n(n);r.a},"1a45":function(t,e,a){"use strict";a.r(e);var n=a("a4b5"),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"row metadata",attrs:{id:"metadata-box"}},[a("div",{staticClass:"col-3"},[a("button",{staticClass:"btn-primary mr-1 mb-1",on:{click:function(e){return t.saveCase(e)}}},[t._v("(^s)ave case to DB")]),a("br"),a("button",{staticClass:"btn-secondary",on:{click:t.clearEdits}},[t._v("Clear All Edits")]),a("span",{attrs:{"aria-live":"polite"}},[t.saveStatus?a("span",{staticClass:"ml-1"},[a("br"),t._v(t._s(t.saveStatus))]):t._e()])]),a("div",{staticClass:"col-8"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-6"},[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"metadata-name-abbreviation"}},[t._v("Short Name")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.metadata.name_abbreviation,expression:"metadata.name_abbreviation"}],attrs:{type:"text",placeholder:"case short name",id:"metadata-name-abbreviation"},domProps:{value:t.metadata.name_abbreviation},on:{input:function(e){e.target.composing||t.$set(t.metadata,"name_abbreviation",e.target.value)}}})])]),a("div",{staticClass:"col-6"},[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"metadata-name"}},[t._v("Long Name")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.metadata.name,expression:"metadata.name"}],attrs:{type:"text",placeholder:"case name",id:"metadata-name"},domProps:{value:t.metadata.name},on:{input:function(e){e.target.composing||t.$set(t.metadata,"name",e.target.value)}}})])]),a("div",{staticClass:"col-6"},[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"metadata-decision-date-original"}},[t._v("Decision Date (YYYY-MM-DD)")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.metadata.decision_date_original,expression:"metadata.decision_date_original"}],attrs:{type:"text",placeholder:"decision date",id:"metadata-decision-date-original"},domProps:{value:t.metadata.decision_date_original},on:{input:function(e){e.target.composing||t.$set(t.metadata,"decision_date_original",e.target.value)}}})])]),a("div",{staticClass:"col-6"},[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"metadata-docket-number"}},[t._v("Docket Number")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.metadata.docket_number,expression:"metadata.docket_number"}],attrs:{type:"text",placeholder:"docket number",id:"metadata-docket-number"},domProps:{value:t.metadata.docket_number},on:{input:function(e){e.target.composing||t.$set(t.metadata,"docket_number",e.target.value)}}})])])])])]),a("div",{staticClass:"row"},[a("div",{staticClass:"col-3 pl-3 pr-3"},[a("div",{staticClass:"sticky-top pt-6"},[a("div",{staticClass:"row mb-3"},[a("div",{staticClass:"col"},[t.currentWord?a("div",{style:{"background-image":"url("+t.currentPage.page.image_url+")","background-size":t.currentPage.page.width+"px",width:t.currentWord.w+"px",height:t.currentWord.h+"px","background-position":"-"+t.currentWord.x+"px -"+t.currentWord.y+"px"}},[t._v(" ")]):a("div",{style:{width:"20rem",height:"2rem"}})])]),a("div",{staticClass:"row"},[a("div",{staticClass:"col-10"},[t.currentWord?a("input",{directives:[{name:"model",rawName:"v-model",value:t.currentWord.string,expression:"currentWord.string"}],ref:"currentWord",attrs:{type:"text",id:"current_word"},domProps:{value:t.currentWord.string},on:{input:function(e){e.target.composing||t.$set(t.currentWord,"string",e.target.value)}}}):a("input",{attrs:{type:"text",disabled:"",placeholder:"current word"}})]),a("div",{staticClass:"col-2"},[a("button",{attrs:{disabled:null===t.currentWord},on:{click:function(e){return t.addSoftHyphen()}}},[t._v("⧟")])])]),a("div",{staticClass:"edits-container row mt-5"},[t._m(0),a("div",{staticClass:"row edited-word-list mt-3"},[a("div",{staticClass:"col-12 "},t._l(t.savedWordEdits,function(e,n){return a("div",{key:n},t._l(e,function(e,r){return a("div",{key:r},[a("div",t._l(e,function(e,i){return a("div",{key:i,staticClass:"row edit-entry"},[a("div",{staticClass:"col-5 word",on:{click:function(e){return t.scrollToWord(n,r,i)}}},[t._v(t._s(e[0]))]),a("div",{staticClass:"col-6 word",on:{click:function(e){return t.scrollToWord(n,r,i)}}},[t._v(t._s(e[1]))]),a("div",{staticClass:"col-1 edit-controls"},[a("span",{staticClass:"edit-delete",on:{click:function(e){return t.removeEdit(n,r,i)}}},[t._v("⊗")])])])}),0)])}),0)}),0)])])])]),a("div",{staticClass:"col-8",attrs:{id:"canvas_div"}},t._l(t.pages,function(e){return a("page",{key:e.id,ref:"pageComponents",refInFor:!0,attrs:{page:e,savedWordEdits:t.savedWordEdits[e.id]}})}),1),a("div",{staticClass:"col-1",attrs:{id:"controls"}},[a("div",{staticClass:"sticky-top pt-6 row"},[a("div",{staticClass:"col viz-controls"},[t.showOcr?a("div",{staticClass:"row ocr-toggle"},[a("button",{staticClass:"toggle-btn on",on:{click:function(e){t.showOcr=!1}}},[t._v("(^O)CR")])]):a("div",{staticClass:"row ocr-toggle"},[a("button",{staticClass:"toggle-btn off",on:{click:function(e){t.showOcr=!0}}},[t._v("(^O)CR")])]),t.showConfidence?a("div",{staticClass:"row wc-toggle"},[a("button",{staticClass:"toggle-btn on",on:{click:function(e){t.showConfidence=!1}}},[t._v("W(^C)")])]):a("div",{staticClass:"row wc-toggle"},[a("button",{staticClass:"toggle-btn off",on:{click:function(e){t.showConfidence=!0}}},[t._v("W(^C)")])]),a("div",{staticClass:"row instruction-toggle"},[a("button",{staticClass:"toggle-btn off",on:{click:t.toggleInstructions}},[t._v("help")])])])])])]),a("div",{staticClass:"pt-6",staticStyle:{display:"none"},attrs:{id:"instructions_modal_overlay"}},[a("div",{staticClass:"col-8 offset-2 p-5",attrs:{id:"instructions_modal"}},[a("div",{attrs:{id:"modal_close"},on:{click:t.toggleInstructions}},[t._v("⊗")]),t._m(1),t._m(2),t._m(3),t._m(4)])])])},i=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"col-5 pt-1"},[a("h4",{staticClass:"edits-title"},[t._v("edits")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"row pt-3"},[a("div",{staticClass:"q col-3"},[t._v("When should I press “Save”?")]),a("div",{staticClass:"a col-9 pl-3"},[t._v("\n          Corrections to a case should be made in a batch, and you should only press “save” when you have made all changes you intend to make to a case. This avoids preserving intermediate edits on the server that aren’t needed. In the meantime, each change you make will be immediately stored to your local browser storage, and will be stored across restarts until you are ready to save.\n        ")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"row pt-3"},[a("div",{staticClass:"q col-3"},[t._v("Why is there a space after each word?")]),a("div",{staticClass:"a col-9 pl-3"},[t._v("\n          The space after each word should be preserved (if it is supposed to be there) -- it controls whether there will be a space between that word and the next word when they are combined into text.\n        ")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"row pt-3"},[a("div",{staticClass:"q col-3"},[t._v("What is the significance of the word confidence labels?")]),a("div",{staticClass:"a col-9 pl-3"},[t._v("\n          The word confidence button highlights words that the OCR engine was less confident about. Word confidence is labeled by the OCR engine on a scale from 0.0 (least confident) to 1.0 (most confident). These scores have no objective meaning.\n        ")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"row pt-3"},[a("div",{staticClass:"q col-3"},[t._v("What is the “⧟” button for?")]),a("div",{staticClass:"a col-9 pl-3"},[t._v("\n          The “⧟” button is for inserting a “soft hyphen.” When the OCR engine sees a hyphen at the end of a line, it has to guess whether to encode the hyphen as a “hard hyphen,” which should be preserved in the text, or a “soft hyphen,” an invisible character which indicates where the word was broken over the line but should not be preserved in text."),a("br"),t._v("\n          For example, if the OCR engine saw “hyphen-” at the end of one line, and “ated” at the start of the next line, it needed to decide whether the text output should be “hyphen-ated” or “hyphenated.” If the engine wrongly output “hyphen-ated”, you could use the soft hyphen button to change it to “hyphen⧟” “ated”, which would render as “hyphenated” in the text.\n        ")])])}],s=(a("a0c4"),a("e9de"),a("1a43"),a("c1c3"),a("477f")),o=(a("67c8"),a("fa38"),a("0012"),a("8430")),c=(a("baa4"),a("5b54"),a("2bf3"),a("ef92"),a("45bc")),l=a("a881"),d=a.n(l),u=(a("ba72"),a("8df7")),h=a.n(u),v=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{class:{page:!0,"show-ocr":t.$parent.showOcr}},[a("img",{attrs:{src:t.page.image_url,width:t.page.width*t.scale,height:t.page.height*t.scale}}),t._l(t.words,function(e,n){return a("span",{key:n,class:t.wordClass(e),style:t.wordStyle(e),attrs:{"scroll-to-here":e.blockId+"_"+n},on:{click:function(a){return t.wordClicked(e)}}},[t._v("\n    "+t._s(e.string)+"\n  ")])})],2)},f=[],p=(a("6ac6"),a("d2d3")),m="­",g="⧟",y={props:["page","savedWordEdits"],data:function(){return{scale:1,words:[]}},computed:{fontScale:function(){return 300*this.scale/72}},watch:{words:{handler:function(){this.$parent.saveStateToStorage()},deep:!0}},beforeMount:function(){var t=this,e=[],a=!0,n=!1,r=void 0;try{for(var i,s=function(){var a=i.value;if(!a.tokens)return"continue";var n=null,r=-1,s=t.savedWordEdits&&t.savedWordEdits[a.id]?t.savedWordEdits[a.id]:{},c=!0,l=!1,d=void 0;try{for(var u,h=a.tokens.entries()[Symbol.iterator]();!(c=(u=h.next()).done);c=!0){var v=Object(o["a"])(u.value,2),f=v[0],y=v[1];if("string"!==typeof y){var b=Object(o["a"])(y,2),w=b[0],C=b[1];if("ocr"===w){var _=C.rect;n={blockId:a.id,wordConfidence:C.wc,font:t.$parent.fonts[r],strings:[],x:_[0],y:_[1],w:_[2],h:_[3]}}else if("/ocr"===w){if(!n)continue;if(n.strings.length){var k=e.length;n.originalString=n.strings.map(function(t){return t.value}).join("").replace(m,g),k in s&&s[k][0]===n.originalString?n.string=s[k][1]:n.string=n.originalString,n.lineHeight=t.$parent.getFontLineHeight(r),n.yOffset=Math.min.apply(Math,Object(p["a"])(n.string.split("").map(function(e){return n.lineHeight-t.$parent.getCharAscent(e,r)}))),e.push(n)}n=null}else"font"===w?r=C.id:"/font"===w&&(r=-1)}else n&&n.strings.push({index:f,value:y})}}catch(x){l=!0,d=x}finally{try{c||null==h.return||h.return()}finally{if(l)throw d}}},c=this.page.blocks[Symbol.iterator]();!(a=(i=c.next()).done);a=!0)s()}catch(l){n=!0,r=l}finally{try{a||null==c.return||c.return()}finally{if(n)throw r}}this.words=e},mounted:function(){var t=this;window.addEventListener("resize",function(){t.handleWindowResize()}),this.handleWindowResize()},methods:{handleWindowResize:function(){this.scale=document.getElementById("canvas_div").offsetWidth/this.page.width},wordStyle:function(t){var e=t.font;return{left:"".concat(t.x*this.scale,"px"),top:"".concat(t.y*this.scale-t.yOffset*this.fontScale-1,"px"),"background-color":this.$parent.showConfidence?this.wordConfidenceColor(t):"unset",font:"".concat(e.styles," ").concat(e.size*this.fontScale,"px/").concat(t.lineHeight*this.fontScale,"px ").concat(e.family)}},wordClass:function(t){return{"current-word":this.$parent.currentWord===t,edited:t.string!==t.originalString}},wordClicked:function(t){var e=this;this.$parent.currentWord=t,this.$parent.currentPage=this,this.$nextTick(function(){e.$parent.$refs.currentWord.focus()})},wordConfidenceColor:function(t){var e=100*(.6-t.wordConfidence),a=255*t.wordConfidence+127;return"rgba(".concat(a,", 0, 0, ").concat(e,"%)")}}},b=y,w=(a("12c0"),a("a6c2")),C=Object(w["a"])(b,v,f,!1,null,"0eb8f200",null),_=C.exports,k=function(t,e){return t.reduce(function(t,a){return t[e(a)]=a,t},{})},x={components:{Page:_},data:function(){return{currentWord:null,currentPage:null,showOcr:!0,showConfidence:!0,metadata:null,savedWordEdits:{},saveStatus:null}},watch:{metadata:{handler:function(){this.saveStateToStorage()},deep:!0}},beforeMount:function(){this.urls=templateVars.urls,this.metadata=templateVars.metadata,this.serverMetadata=Object(c["a"])({},this.metadata),this.pages=templateVars.pages,this.pagesById=k(this.pages,function(t){return t.id}),this.fonts=templateVars.fonts;for(var t=0,e=Object.keys(this.fonts);t<e.length;t++){var a=e[t];this.fonts[a]=this.processFont(this.fonts[a])}this.fonts[-1]={styles:"",family:"Times New Roman",size:12},this.charAscentCache={},this.storageKey="caseedit-".concat(this.metadata.id),this.savedWordEdits={};var n=localStorage.getItem(this.storageKey);if(n)try{var r=JSON.parse(n);if(this.savedWordEdits=r.edit_list,Object.keys(r.metadata).length>0)for(var i=0,s=Object.entries(r.metadata);i<s.length;i++){var l=Object(o["a"])(s[i],2),d=l[0],u=Object(o["a"])(l[1],2),h=u[0],v=u[1];this.metadata[d]===h&&(this.metadata[d]=v)}}catch(f){console.log("Error applying edit_list to server state",f),localStorage.removeItem(this.storageKey)}},mounted:function(){var t=this;document.addEventListener("keyup",function(e){if(e.ctrlKey)switch(e.key){case"o":t.showOcr=!t.showOcr;break;case"c":t.showConfidence=!t.showConfidence;break;case"s":t.saveCase();break;default:break}}),this.pageComponentsById=k(this.$refs.pageComponents,function(t){return t.page.id})},methods:{toggleInstructions:function(){var t=document.getElementById("instructions_modal_overlay");t.style.display="none"===t.style.display?"block":"none"},scrollToWord:function(t,e,a){var n=this.pageComponentsById[parseInt(t)];n.wordClicked(n.words[a]),document.body.querySelector('span[scroll-to-here="'.concat(e,"_").concat(a,'"]')).scrollIntoView()},removeEdit:function(t,e,a){var n=this.pageComponentsById[parseInt(t)].words[a];n.string=n.originalString},clearEdits:function(){if(confirm("CONFIRM: permanently discard your edits?\nThere is no undo for this command.")){localStorage.removeItem(this.storageKey),this.metadata=Object(c["a"])({},this.serverMetadata);var t=!0,e=!1,a=void 0;try{for(var n,r=this.$refs.pageComponents[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var i=n.value,s=!0,o=!1,l=void 0;try{for(var d,u=i.words[Symbol.iterator]();!(s=(d=u.next()).done);s=!0){var h=d.value;h.string!==h.originalString&&(h.string=h.originalString)}}catch(v){o=!0,l=v}finally{try{s||null==u.return||u.return()}finally{if(o)throw l}}}}catch(v){e=!0,a=v}finally{try{t||null==r.return||r.return()}finally{if(e)throw a}}}},getMetadataEdits:function(){for(var t={},e=0,a=Object.entries(this.metadata);e<a.length;e++){var n=Object(o["a"])(a[e],2),r=n[0],i=n[1],s=this.serverMetadata[r];i!==s&&(t[r]=[s,i])}return t},getTokenEdits:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e={},a=!0,n=!1,r=void 0;try{for(var i,s=this.$refs.pageComponents[Symbol.iterator]();!(a=(i=s.next()).done);a=!0){var c=i.value,l=c.page.id,d=!0,u=!1,h=void 0;try{for(var v,f=c.words.entries()[Symbol.iterator]();!(d=(v=f.next()).done);d=!0){var p=Object(o["a"])(v.value,2),y=p[0],b=p[1];if(b.string!==b.originalString)if(e[l]||(e[l]={}),e[l][b.blockId]||(e[l][b.blockId]={}),t)e[l][b.blockId][y]=[b.originalString,b.string];else{var w=b.string.replace(g,m),C=!0,_=!1,k=void 0;try{for(var x,S=b.strings.entries()[Symbol.iterator]();!(C=(x=S.next()).done);C=!0){var O=Object(o["a"])(x.value,2),W=O[0],E=O[1];e[l][b.blockId][E.index]=[E.value,0===W?w:""]}}catch(j){_=!0,k=j}finally{try{C||null==S.return||S.return()}finally{if(_)throw k}}}}}catch(j){u=!0,h=j}finally{try{d||null==f.return||f.return()}finally{if(u)throw h}}}}catch(j){n=!0,r=j}finally{try{a||null==s.return||s.return()}finally{if(n)throw r}}return e},getState:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return{metadata:this.getMetadataEdits(),edit_list:this.getTokenEdits(t)}},saveStateToStorage:h()(function(){var t=this.getState(!0);localStorage.setItem(this.storageKey,JSON.stringify(t)),this.savedWordEdits=t["edit_list"]},500),saveCase:function(){var t=Object(s["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(confirm("CONFIRM: permanently overwrite "+this.metadata.name+" in the CAP database with your edited version?\nThere is no undo for this command.")){t.next=2;break}return t.abrupt("return");case 2:return this.saveStatus="saving ...",t.prev=3,t.next=6,d.a.ajax("",{type:"POST",data:JSON.stringify(this.getState()),contentType:"application/json"}).promise();case 6:t.next=12;break;case 8:return t.prev=8,t.t0=t["catch"](3),this.saveStatus="error saving: ".concat(t.t0),t.abrupt("return");case 12:localStorage.removeItem(this.storageKey),window.location.href=this.urls.case;case 14:case"end":return t.stop()}},t,this,[[3,8]])}));function e(){return t.apply(this,arguments)}return e}(),getCharAscent:function(t,e){var a="".concat(e,"-").concat(t);if(!this.charAscentCache.hasOwnProperty(a)){var n=document.createElement("canvas"),r=n.getContext("2d"),i=this.fonts[e];r.font="".concat(i.styles," ").concat(i.size,"pt ").concat(i.family),this.charAscentCache[a]=3*r.measureText(t).actualBoundingBoxAscent/4}return this.charAscentCache[a]},getFontLineHeight:function(t){return this.getCharAscent("T",t)},addSoftHyphen:function(){this.currentWord.string=this.currentWord.string+g},processFont:function(t){var e=[];return t.style.includes("italics")&&e.push("italic"),t.style.includes("smallcaps")&&e.push("small-caps"),t.style.includes("bold")&&e.push("bold"),{family:'"'.concat(t.family,'",').concat(t.type),size:parseFloat(t.size),styles:e.join(" ")}}}},S=x,O=Object(w["a"])(S,r,i,!1,null,null,null),W=O.exports;new n["default"]({el:"#app",components:{Main:W},template:"<Main/>"})},9692:function(t,e,a){}});
//# sourceMappingURL=case-editor.1fcad8f6.js.map