(function(e){function t(t){for(var r,i,s=t[0],c=t[1],l=t[2],u=0,f=[];u<s.length;u++)i=s[u],a[i]&&f.push(a[i][0]),a[i]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);d&&d(t);while(f.length)f.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==a[c]&&(r=!1)}r&&(o.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},a={"case-editor":0},o=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/static/dist/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var d=c;o.push([10,"chunk-common"]),n()})({10:function(e,t,n){e.exports=n("1a45")},"1a45":function(e,t,n){"use strict";n.r(t);var r=n("a026"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"row grid-container"},[n("div",{staticClass:"col-3 controls grid-item"},[n("div",{staticClass:"sticky-top pt-5"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.showOcr,expression:"showOcr"}],attrs:{type:"checkbox",id:"show_ocr"},domProps:{checked:Array.isArray(e.showOcr)?e._i(e.showOcr,null)>-1:e.showOcr},on:{change:function(t){var n=e.showOcr,r=t.target,a=!!r.checked;if(Array.isArray(n)){var o=null,i=e._i(n,o);r.checked?i<0&&(e.showOcr=n.concat([o])):i>-1&&(e.showOcr=n.slice(0,i).concat(n.slice(i+1)))}else e.showOcr=a}}}),n("label",{attrs:{for:"show_ocr"}},[e._v("OCR text")]),n("br"),n("input",{directives:[{name:"model",rawName:"v-model",value:e.showConfidence,expression:"showConfidence"}],attrs:{type:"checkbox",id:"see_wc"},domProps:{checked:Array.isArray(e.showConfidence)?e._i(e.showConfidence,null)>-1:e.showConfidence},on:{change:function(t){var n=e.showConfidence,r=t.target,a=!!r.checked;if(Array.isArray(n)){var o=null,i=e._i(n,o);r.checked?i<0&&(e.showConfidence=n.concat([o])):i>-1&&(e.showConfidence=n.slice(0,i).concat(n.slice(i+1)))}else e.showConfidence=a}}}),n("label",{attrs:{for:"see_wc"}},[e._v("Word confidence")]),e.currentWord?n("div",[n("div",{style:{"background-image":"url("+e.currentPage.page.image_url+")","background-size":e.currentPage.page.width+"px",width:e.currentWord.w+"px",height:e.currentWord.h+"px","background-position":"-"+e.currentWord.x+"px -"+e.currentWord.y+"px"}}),n("input",{directives:[{name:"model",rawName:"v-model",value:e.currentWord.string,expression:"currentWord.string"}],ref:"currentWord",attrs:{type:"text",id:"current_word"},domProps:{value:e.currentWord.string},on:{input:function(t){t.target.composing||e.$set(e.currentWord,"string",t.target.value)}}}),n("small",[n("small",[e._v("\n          (confidence: "),n("span",{attrs:{id:"current_word_confidence"}},[e._v(e._s(e.currentWord.word_confidence))]),e._v(")\n        ")])]),n("button",{on:{click:function(t){return e.addSoftHyphen()}}},[e._v("Add Soft Hyphen(⧟)")])]):e._e(),n("input",{directives:[{name:"model",rawName:"v-model",value:e.metadata.name,expression:"metadata.name"}],attrs:{type:"text",placeholder:"case name"},domProps:{value:e.metadata.name},on:{input:function(t){t.target.composing||e.$set(e.metadata,"name",t.target.value)}}}),n("input",{directives:[{name:"model",rawName:"v-model",value:e.metadata.docket_number,expression:"metadata.docket_number"}],attrs:{type:"text",placeholder:"docket number"},domProps:{value:e.metadata.docket_number},on:{input:function(t){t.target.composing||e.$set(e.metadata,"docket_number",t.target.value)}}}),n("input",{directives:[{name:"model",rawName:"v-model",value:e.metadata.decision_date_original,expression:"metadata.decision_date_original"}],attrs:{type:"text",placeholder:"decision date string"},domProps:{value:e.metadata.decision_date_original},on:{input:function(t){t.target.composing||e.$set(e.metadata,"decision_date_original",t.target.value)}}}),n("button",{staticClass:"danger",on:{click:e.saveCase}},[e._v("Save Case To Database")]),n("div",[e._v("\n        All changes are saved locally in your browser until you are ready to commit a batch of changes to the\n        database.\n      ")])])]),n("div",{staticClass:"col-9 grid-item",attrs:{id:"canvas_div"}},e._l(e.pages,function(t){return n("page",{key:t.id,ref:"pageComponents",refInFor:!0,attrs:{page:t,savedWordEdits:e.savedWordEdits[t.id]}})}),1)])},o=[],i=(n("6762"),n("2fdb"),n("96cf"),n("3b8d")),s=(n("a481"),n("ac4d"),n("8a81"),n("768b")),c=(n("ffc1"),n("ac6a"),n("cadf"),n("456d"),n("cebc")),l=n("1157"),d=n.n(l),u=(n("ba72"),n("f7fe")),f=n.n(u),h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{page:!0,"show-ocr":e.$parent.showOcr}},[n("img",{attrs:{src:e.page.image_url,width:e.page.width*e.scale,height:e.page.height*e.scale}}),e._l(e.words,function(t){return n("span",{class:e.wordClass(t),style:e.wordStyle(t),on:{click:function(n){return e.wordClicked(t)}}},[e._v("\n    "+e._s(t.string)+"\n  ")])})],2)},p=[],g=(n("28a5"),n("75fc")),v="­",m="⧟",y={props:["page","savedWordEdits"],data:function(){return{scale:1,words:[]}},computed:{fontScale:function(){return 300*this.scale/72}},watch:{words:{handler:function(){this.$parent.saveStateToStorage()},deep:!0}},beforeMount:function(){var e=this,t=[],n=!0,r=!1,a=void 0;try{for(var o,i=function(){var n=o.value;if(!n.tokens)return"continue";var r=null,a=-1,i=e.savedWordEdits&&e.savedWordEdits[n.id]?e.savedWordEdits[n.id]:{},c=!0,l=!1,d=void 0;try{for(var u,f=n.tokens.entries()[Symbol.iterator]();!(c=(u=f.next()).done);c=!0){var h=Object(s["a"])(u.value,2),p=h[0],y=h[1];if("string"!==typeof y){var w=Object(s["a"])(y,2),b=w[0],_=w[1];if("ocr"===b){var x=_.rect;r={blockId:n.id,wordConfidence:_.wc,font:e.$parent.fonts[a],strings:[],x:x[0],y:x[1],w:x[2],h:x[3]}}else if("/ocr"===b){if(!r)continue;if(r.strings.length){var O=t.length;r.originalString=r.strings.map(function(e){return e.value}).join("").replace(v,m),O in i&&i[O][0]===r.originalString?r.string=i[O][1]:r.string=r.originalString,r.lineHeight=e.$parent.getFontLineHeight(a),r.yOffset=Math.min.apply(Math,Object(g["a"])(r.string.split("").map(function(t){return r.lineHeight-e.$parent.getCharAscent(t,a)}))),t.push(r)}r=null}else"font"===b?a=_.id:"/font"===b&&(a=-1)}else r&&r.strings.push({index:p,value:y})}}catch(S){l=!0,d=S}finally{try{c||null==f.return||f.return()}finally{if(l)throw d}}},c=this.page.blocks[Symbol.iterator]();!(n=(o=c.next()).done);n=!0)i()}catch(l){r=!0,a=l}finally{try{n||null==c.return||c.return()}finally{if(r)throw a}}this.words=t},mounted:function(){this.scale=document.getElementById("canvas_div").offsetWidth/this.page.width},methods:{wordStyle:function(e){var t=e.font;return{left:"".concat(e.x*this.scale,"px"),top:"".concat(e.y*this.scale-e.yOffset*this.fontScale-1,"px"),"background-color":this.$parent.showConfidence?this.wordConfidenceColor(e):"unset",font:"".concat(t.styles," ").concat(t.size*this.fontScale,"px/").concat(e.lineHeight*this.fontScale,"px ").concat(t.family)}},wordClass:function(e){return{"current-word":this.$parent.currentWord===e,edited:e.string!==e.originalString}},wordClicked:function(e){var t=this;this.$parent.currentWord=e,this.$parent.currentPage=this,this.$nextTick(function(){t.$parent.$refs.currentWord.focus()})},wordConfidenceColor:function(e){var t=100*(.6-e.wordConfidence),n=255*e.wordConfidence+127;return"rgba(".concat(n,", 0, 0, ").concat(t,"%)")}}},w=y,b=(n("febe"),n("2877")),_=Object(b["a"])(w,h,p,!1,null,"0ae31a18",null),x=_.exports,O={components:{Page:x},data:function(){return{currentWord:null,currentPage:null,showOcr:!0,showConfidence:!0,metadata:null}},watch:{metadata:{handler:function(){this.saveStateToStorage()},deep:!0}},beforeMount:function(){this.urls=templateVars.urls,this.metadata=templateVars.metadata,this.serverMetadata=Object(c["a"])({},this.metadata),this.pages=templateVars.pages,this.fonts=templateVars.fonts;for(var e=0,t=Object.keys(this.fonts);e<t.length;e++){var n=t[e];this.fonts[n]=this.processFont(this.fonts[n])}this.fonts[-1]={styles:"",family:"Times New Roman",size:12},this.charAscentCache={},this.storageKey="caseedit-".concat(this.metadata.id),this.savedWordEdits={};var r=localStorage.getItem(this.storageKey);if(r)try{var a=JSON.parse(r);if(this.savedWordEdits=a.edit_list,Object.keys(a.metadata).length>0)for(var o=0,i=Object.entries(a.metadata);o<i.length;o++){var l=Object(s["a"])(i[o],2),d=l[0],u=Object(s["a"])(l[1],2),f=u[0],h=u[1];this.metadata[d]===f&&(this.metadata[d]=h)}}catch(p){console.log("Error applying edit_list to server state",p),localStorage.removeItem(this.storageKey)}},methods:{getMetadataEdits:function(){for(var e={},t=0,n=Object.entries(this.metadata);t<n.length;t++){var r=Object(s["a"])(n[t],2),a=r[0],o=r[1],i=this.serverMetadata[a];o!==i&&(e[a]=[i,o])}return e},getTokenEdits:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t={},n=!0,r=!1,a=void 0;try{for(var o,i=this.$refs.pageComponents[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var c=o.value,l=c.page.id,d=!0,u=!1,f=void 0;try{for(var h,p=c.words.entries()[Symbol.iterator]();!(d=(h=p.next()).done);d=!0){var g=Object(s["a"])(h.value,2),y=g[0],w=g[1];if(w.string!==w.originalString)if(t[l]||(t[l]={}),t[l][w.blockId]||(t[l][w.blockId]={}),e)t[l][w.blockId][y]=[w.originalString,w.string];else{var b=w.string.replace(m,v),_=!0,x=!1,O=void 0;try{for(var S,k=w.strings.entries()[Symbol.iterator]();!(_=(S=k.next()).done);_=!0){var C=Object(s["a"])(S.value,2),j=C[0],W=C[1];t[l][w.blockId][W.index]=[W.value,0===j?b:""]}}catch(P){x=!0,O=P}finally{try{_||null==k.return||k.return()}finally{if(x)throw O}}}}}catch(P){u=!0,f=P}finally{try{d||null==p.return||p.return()}finally{if(u)throw f}}}}catch(P){r=!0,a=P}finally{try{n||null==i.return||i.return()}finally{if(r)throw a}}return t},getState:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return{metadata:this.getMetadataEdits(),edit_list:this.getTokenEdits(e)}},saveStateToStorage:f()(function(){localStorage.setItem(this.storageKey,JSON.stringify(this.getState(!0)))},1e3),saveCase:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.a.ajax("",{type:"POST",data:JSON.stringify(this.getState()),contentType:"application/json"}).promise();case 3:e.next=9;break;case 5:return e.prev=5,e.t0=e["catch"](0),console.log("error saving:",e.t0),e.abrupt("return");case 9:localStorage.removeItem(this.storageKey),window.location.href=this.urls.case;case 11:case"end":return e.stop()}},e,this,[[0,5]])}));function t(){return e.apply(this,arguments)}return t}(),getCharAscent:function(e,t){var n="".concat(t,"-").concat(e);if(!this.charAscentCache.hasOwnProperty(n)){var r=document.createElement("canvas"),a=r.getContext("2d"),o=this.fonts[t];a.font="".concat(o.styles," ").concat(o.size,"pt ").concat(o.family),this.charAscentCache[n]=3*a.measureText(e).actualBoundingBoxAscent/4}return this.charAscentCache[n]},getFontLineHeight:function(e){return this.getCharAscent("T",e)},addSoftHyphen:function(){document.execCommand("insertText",!1,m)},processFont:function(e){var t=[];return e.style.includes("italics")&&t.push("italic"),e.style.includes("smallcaps")&&t.push("small-caps"),e.style.includes("bold")&&t.push("bold"),{family:'"'.concat(e.family,'",').concat(e.type),size:parseFloat(e.size),styles:t.join(" ")}}}},S=O,k=Object(b["a"])(S,a,o,!1,null,null,null),C=k.exports;r["default"].config.devtools=!0,r["default"].config.productionTip=!1,new r["default"]({el:"#app",components:{Main:C},template:"<Main/>"})},d84b:function(e,t,n){},febe:function(e,t,n){"use strict";var r=n("d84b"),a=n.n(r);a.a}});
//# sourceMappingURL=case-editor.d5936c5a.js.map